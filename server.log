nohup: ignoring input

> rest-express@1.0.0 dev
> NODE_ENV=development tsx server/index.ts

XAI Grok Engine: API key not configured, using pattern-based fallback
12:26:35 AM [express] Checking database connection...
12:26:35 AM [database] Database connection successful
XAI Grok Engine: API key not configured, using pattern-based fallback
✅ Settings routes registered successfully
XAI Grok Engine: API key not configured, using pattern-based fallback
XAI Grok Engine: API key not configured, using pattern-based fallback
XAI Grok Engine: API key not configured, using pattern-based fallback
XAI Grok Engine: API key not configured, using pattern-based fallback
XAI Grok Engine: API key not configured, using pattern-based fallback
XAI Grok Engine: API key not configured, using pattern-based fallback
XAI Grok Engine: API key not configured, using pattern-based fallback
XAI Grok Engine: API key not configured, using pattern-based fallback
XAI Grok Engine: API key not configured, using pattern-based fallback
12:26:35 AM [express] serving on port 5000
12:26:35 AM [express] Environment: development
12:26:35 AM [express] Health check available at /health
GET /health 200 in 3ms
GET /health 200 in 2ms
POST /api/auth/login 200 in 126ms
12:27:07 AM [express] POST /api/auth/login 200 in 124ms :: {"success":true,"message":"ورود موفقیت‌آمی…
✅ CRM Session saved successfully: {
  sessionId: 'ijKvzkeCHuzUe9BO26_Q2_hQbUoh25R7',
  user: {
    id: 1,
    username: 'crm',
    fullName: 'مدیر CRM',
    role: 'CRM_MANAGER',
    permissions: [ 'VIEW_REPRESENTATIVES', 'MANAGE_TASKS', 'VIEW_ANALYTICS' ],
    panelType: 'CRM_PANEL'
  },
  authenticated: true
}
POST /api/crm/auth/login 200 in 92ms
12:27:07 AM [express] POST /api/crm/auth/login 200 in 92ms :: {"success":true,"message":"ورود موفقیت‌…
GET /api/auth/check 200 in 0ms
12:27:17 AM [express] GET /api/auth/check 200 in 2ms :: {"authenticated":true,"user":{"id":1,"usernam…
🔍 CRM Auth Check - Session Data: {
  sessionId: 'ijKvzkeCHuzUe9BO26_Q2_hQbUoh25R7',
  crmAuthenticated: true,
  crmUser: {
    id: 1,
    username: 'crm',
    fullName: 'مدیر CRM',
    role: 'CRM_MANAGER',
    permissions: [ 'VIEW_REPRESENTATIVES', 'MANAGE_TASKS', 'VIEW_ANALYTICS' ],
    panelType: 'CRM_PANEL'
  },
  hasSession: true,
  sessionObject: Session {
    cookie: {
      path: '/',
      _expires: 2025-08-18T00:27:07.643Z,
      originalMaxAge: 604800000,
      httpOnly: true,
      secure: false,
      sameSite: 'lax'
    },
    crmAuthenticated: true,
    crmUser: {
      id: 1,
      username: 'crm',
      fullName: 'مدیر CRM',
      role: 'CRM_MANAGER',
      permissions: [Array],
      panelType: 'CRM_PANEL'
    }
  }
}
✅ CRM Auth Success - Returning user: {
  id: 1,
  username: 'crm',
  fullName: 'مدیر CRM',
  role: 'CRM_MANAGER',
  permissions: [ 'VIEW_REPRESENTATIVES', 'MANAGE_TASKS', 'VIEW_ANALYTICS' ],
  panelType: 'CRM_PANEL'
}
GET /api/crm/auth/user 200 in 1ms
12:27:17 AM [express] GET /api/crm/auth/user 200 in 3ms :: {"id":1,"username":"crm","fullName":"مدیر …
POST /api/auth/login 401 in 2ms
12:27:17 AM [express] POST /api/auth/login 401 in 2ms :: {"error":"نام کاربری یا رمز عبور اشتباه است"}
🎯 SHERLOCK v10.0: No significant batch found, using recent activity count: 0
GET /api/dashboard 200 in 11ms
12:27:27 AM [express] GET /api/dashboard 200 in 13ms :: {"totalRevenue":"0","totalDebt":"0","activeRe…
GET /api/representatives 200 in 1ms
12:27:27 AM [express] GET /api/representatives 200 in 3ms :: []
🎯 SHERLOCK v11.0 BATCH-SYNC: No significant batch found, using recent activity count: 0
📊 SHERLOCK v11.0: Representatives statistics - Active: 0 (batch-based), Total: 0
GET /api/representatives/statistics 200 in 3ms
12:27:27 AM [express] GET /api/representatives/statistics 200 in 6ms :: {"totalCount":0,"activeCount"…
Memory usage: { rss: 205.47, heapTotal: 68.66, heapUsed: 66.76, external: 4.6 }
POST /api/representatives 200 in 6ms
12:27:39 AM [express] POST /api/representatives 200 in 7ms :: {"id":1,"code":"TEST001","name":"فروشگا…
GET /api/representatives/1 404 in 2ms
12:27:51 AM [express] GET /api/representatives/1 404 in 4ms :: {"error":"نماینده یافت نشد"}
🔧 فاز ۲: ایجاد فاکتور دستی
💰 Financial update for representative 1: {
  unpaidAmount: 100000,
  totalPayments: 0,
  actualDebt: 100000,
  totalSales: '100000.00',
  credit: 0
}
💰 Financial update for representative 1: {
  unpaidAmount: 100000,
  totalPayments: 0,
  actualDebt: 100000,
  totalSales: '100000.00',
  credit: 0
}
POST /api/invoices/create-manual 200 in 19ms
12:27:51 AM [express] POST /api/invoices/create-manual 200 in 20ms :: {"success":true,"invoice":{"id"…
Memory usage: { rss: 205.97, heapTotal: 68.91, heapUsed: 66.91, external: 4.6 }
Browserslist: browsers data (caniuse-lite) is 10 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
GET /api/auth/check 401 in 0ms
12:28:43 AM [express] GET /api/auth/check 401 in 1ms :: {"authenticated":false}
🔍 CRM Auth Check - Session Data: {
  sessionId: 'r-K_2Tk8Kgz2EFCJrdA_hxbEPLw-idld',
  crmAuthenticated: undefined,
  crmUser: undefined,
  hasSession: true,
  sessionObject: Session {
    cookie: {
      path: '/',
      _expires: 2025-08-18T00:28:43.744Z,
      originalMaxAge: 604800000,
      httpOnly: true,
      secure: false,
      sameSite: 'lax'
    }
  }
}
❌ CRM Auth Failed - Session invalid or expired
GET /api/crm/auth/user 401 in 1ms
12:28:43 AM [express] GET /api/crm/auth/user 401 in 1ms :: {"error":"احراز هویت نشده"}
🔍 CRM Auth Check - Session Data: {
  sessionId: '3KuoMsr9zROiBLPwSWYl4MIrD-RCvb2E',
  crmAuthenticated: undefined,
  crmUser: undefined,
  hasSession: true,
  sessionObject: Session {
    cookie: {
      path: '/',
      _expires: 2025-08-18T00:28:44.608Z,
      originalMaxAge: 604800000,
      httpOnly: true,
      secure: false,
      sameSite: 'lax'
    }
  }
}
❌ CRM Auth Failed - Session invalid or expired
GET /api/crm/auth/user 401 in 1ms
12:28:44 AM [express] GET /api/crm/auth/user 401 in 1ms :: {"error":"احراز هویت نشده"}
📋 SHERLOCK v12.1: Fetching all invoices for main invoices page
✅ 1 فاکتور در 4ms بارگذاری شد
GET /api/invoices 200 in 5ms
12:28:51 AM [express] GET /api/invoices 200 in 6ms :: [{"id":1,"invoiceNumber":"INV-071903449","repre…
🔍 CRM Auth Check - Session Data: {
  sessionId: 'SVNgBed1sS-fPkdlFsmk98L6r4zOY3j4',
  crmAuthenticated: undefined,
  crmUser: undefined,
  hasSession: true,
  sessionObject: Session {
    cookie: {
      path: '/',
      _expires: 2025-08-18T00:28:56.320Z,
      originalMaxAge: 604800000,
      httpOnly: true,
      secure: false,
      sameSite: 'lax'
    }
  }
}
❌ CRM Auth Failed - Session invalid or expired
GET /api/crm/auth/user 401 in 1ms
12:28:56 AM [express] GET /api/crm/auth/user 401 in 2ms :: {"error":"احراز هویت نشده"}
POST /api/auth/login 200 in 89ms
12:29:05 AM [express] POST /api/auth/login 200 in 90ms :: {"success":true,"message":"ورود موفقیت‌آمیز…
GET /api/settings/telegram_bot_token 200 in 2ms
12:29:05 AM [express] GET /api/settings/telegram_bot_token 200 in 6ms
GET /api/representatives 200 in 2ms
12:29:05 AM [express] GET /api/representatives 200 in 4ms :: [{"id":1,"code":"TEST001","name":"فروشگا…
🎯 SHERLOCK v11.0 BATCH-SYNC: No significant batch found, using recent activity count: 1
📊 SHERLOCK v11.0: Representatives statistics - Active: 1 (batch-based), Total: 1
GET /api/representatives/statistics 200 in 3ms
12:29:05 AM [express] GET /api/representatives/statistics 200 in 5ms :: {"totalCount":1,"activeCount"…
🎯 SHERLOCK v10.0: No significant batch found, using recent activity count: 1
GET /api/dashboard 200 in 9ms
12:29:08 AM [express] GET /api/dashboard 200 in 11ms :: {"totalRevenue":"0","totalDebt":"100000","act…
📋 SHERLOCK v12.1: Fetching all invoices for main invoices page
✅ 1 فاکتور در 3ms بارگذاری شد
GET /api/invoices 200 in 4ms
12:29:08 AM [express] GET /api/invoices 200 in 7ms :: [{"id":1,"invoiceNumber":"INV-071903449","repre…
GET /api/invoices/1 200 in 2ms
12:29:09 AM [express] GET /api/invoices/1 200 in 6ms :: {"id":1,"invoiceNumber":"INV-071903449","repr…
12:29:09 AM [express] GET /api/currency/ai-analysis 200 in 15ms
GET /api/dashboard/debtor-representatives 200 in 2ms
12:29:09 AM [express] GET /api/dashboard/debtor-representatives 200 in 5ms :: [{"id":1,"name":"فروشگا…
GET /api/payments 200 in 2ms
12:29:24 AM [express] GET /api/payments 200 in 4ms :: []
12:29:24 AM [express] GET /api/settings 200 in 7ms
Memory usage: { rss: 264.15, heapTotal: 112.6, heapUsed: 109.21, external: 10.89 }
12:29:36 AM [express] GET /api/settings 200 in 13ms
12:29:36 AM [express] POST /api/ai/tasks/generate 200 in 7ms
12:29:36 AM [express] POST /api/reports/performance 200 in 4ms
GET /api/representatives/1 404 in 2ms
12:30:11 AM [express] GET /api/representatives/1 404 in 5ms :: {"error":"نماینده یافت نشد"}
📋 SHERLOCK v12.4: Fetching manual invoices
📋 SHERLOCK v12.4: Retrieved 1 manual invoices (page 1/1)
📋 Found 1 manual invoices
GET /api/invoices/manual 200 in 12ms
12:30:11 AM [express] GET /api/invoices/manual 200 in 13ms :: {"data":[{"id":1,"invoiceNumber":"INV-0…
📋 SHERLOCK v12.4: Fetching manual invoices
📋 SHERLOCK v12.4: Retrieved 1 manual invoices (page 1/1)
📋 Found 1 manual invoices
GET /api/invoices/manual 200 in 3ms
12:30:30 AM [express] GET /api/invoices/manual 200 in 5ms :: {"data":[{"id":1,"invoiceNumber":"INV-07…
PUT /api/representatives/1 200 in 3ms
12:30:30 AM [express] PUT /api/representatives/1 200 in 4ms :: {"id":1,"code":"TEST001","name":"فروشگ…
Memory usage: { rss: 264.9, heapTotal: 113.1, heapUsed: 109.63, external: 10.87 }
POST /api/auth/login 401 in 2ms
12:30:41 AM [express] POST /api/auth/login 401 in 2ms :: {"error":"نام کاربری یا رمز عبور اشتباه است"}
12:30:41 AM [express] GET /api/crm/workspaces 200 in 5ms
POST /api/auth/login 401 in 2ms
12:30:50 AM [express] POST /api/auth/login 401 in 2ms :: {"error":"نام کاربری یا رمز عبور اشتباه است"}
12:30:50 AM [express] GET /api/crm/workspaces 200 in 5ms
12:31:07 AM [express] POST /api/admin/users 200 in 8ms
GET /api/sales-partners 200 in 1ms
12:31:07 AM [express] GET /api/sales-partners 200 in 4ms :: []
POST /api/sales-partners 200 in 4ms
12:31:17 AM [express] POST /api/sales-partners 200 in 5ms :: {"id":1,"name":"شریک فروش تست","phone":n…
📊 SHERLOCK v12.4: Manual invoices statistics - Total: 1, Amount: 100000.00
GET /api/invoices/manual/statistics 200 in 2ms
12:31:17 AM [express] GET /api/invoices/manual/statistics 200 in 4ms :: {"totalCount":1,"totalAmount"…
GET /api/payments/statistics 200 in 2ms
12:31:17 AM [express] GET /api/payments/statistics 200 in 4ms :: {"totalPayments":"0","totalAmount":"…
POST /api/payments 400 in 2ms
12:31:25 AM [express] POST /api/payments 400 in 4ms :: {"error":"داده‌های ورودی نامعتبر","details":[{…
GET /api/portal/TEST001 404 in 2ms
12:31:25 AM [express] GET /api/portal/TEST001 404 in 2ms :: {"error":"پورتال یافت نشد"}
Memory usage: { rss: 265.53, heapTotal: 113.6, heapUsed: 110.3, external: 10.88 }
💰 Financial update for representative 1: {
  unpaidAmount: 100000,
  totalPayments: 50000,
  actualDebt: 50000,
  totalSales: '100000.00',
  credit: 0
}
🔄 SHERLOCK v1.0: Auto-allocating payment 1 to representative 1
📋 Found 1 unpaid invoices, oldest: INV-071903449 (1403/05/15)
💰 Financial update for representative 1: {
  unpaidAmount: 100000,
  totalPayments: 50000,
  actualDebt: 50000,
  totalSales: '100000.00',
  credit: 0
}
POST /api/payments 200 in 17ms
12:31:36 AM [express] POST /api/payments 200 in 18ms :: {"id":1,"representativeId":1,"invoiceId":1,"a…
GET /api/admin/data-counts 200 in 3ms
12:31:36 AM [express] GET /api/admin/data-counts 200 in 5ms :: {"representatives":1,"invoices":1,"pay…
POST /api/settings/xai-grok/test 200 in 1ms
12:31:36 AM [express] POST /api/settings/xai-grok/test 200 in 2ms :: {"success":false,"message":"کلید…
GET /api/admin/data-counts 200 in 4ms
12:31:50 AM [express] GET /api/admin/data-counts 200 in 7ms :: {"representatives":1,"invoices":1,"pay…
GET /api/sync/status 200 in 5ms
12:32:01 AM [express] GET /api/sync/status 200 in 7ms :: {"lastSyncTime":"2025-08-11T00:32:01.881Z","…
💰 Financial update for representative 1: {
  unpaidAmount: 100000,
  totalPayments: 50000,
  actualDebt: 50000,
  totalSales: '100000.00',
  credit: 0
}
POST /api/sync/force-update 200 in 5ms
12:32:01 AM [express] POST /api/sync/force-update 200 in 6ms :: {"success":true,"message":"همگام‌سازی…
GET /api/dashboard/debtor-representatives 200 in 3ms
12:32:01 AM [express] GET /api/dashboard/debtor-representatives 200 in 6ms :: [{"id":1,"name":"فروشگا…
GET /api/sync/status 200 in 3ms
12:32:10 AM [express] GET /api/sync/status 200 in 5ms :: {"lastSyncTime":"2025-08-11T00:32:10.846Z","…
💰 Financial update for representative 1: {
  unpaidAmount: 100000,
  totalPayments: 50000,
  actualDebt: 50000,
  totalSales: '100000.00',
  credit: 0
}
POST /api/sync/force-update 200 in 6ms
12:32:10 AM [express] POST /api/sync/force-update 200 in 6ms :: {"success":true,"message":"همگام‌سازی…
GET /api/dashboard/debtor-representatives 200 in 2ms
12:32:10 AM [express] GET /api/dashboard/debtor-representatives 200 in 4ms :: [{"id":1,"name":"فروشگا…
12:32:27 AM [express] POST /api/upload/invoices 200 in 9ms
Memory usage: { rss: 266.15, heapTotal: 115.1, heapUsed: 110.65, external: 10.88 }
12:32:37 AM [express] POST /api/upload/invoices 200 in 6ms
12:32:37 AM [express] POST /api/invoices/1/telegram 200 in 7ms
📋 SHERLOCK v12.1: Fetching all invoices for main invoices page
✅ 1 فاکتور در 3ms بارگذاری شد
GET /api/invoices 200 in 3ms
12:33:00 AM [express] GET /api/invoices 200 in 4ms :: [{"id":1,"invoiceNumber":"INV-071903449","repre…
📋 SHERLOCK v12.1: Fetching all invoices for main invoices page
✅ 1 فاکتور در 2ms بارگذاری شد
GET /api/invoices 200 in 2ms
12:33:08 AM [express] GET /api/invoices 200 in 4ms :: [{"id":1,"invoiceNumber":"INV-071903449","repre…
🎯 SHERLOCK v10.0: No significant batch found, using recent activity count: 1
POST /api/ai/analyze-financial 200 in 9ms
12:33:19 AM [express] POST /api/ai/analyze-financial 200 in 11ms :: {"overallHealth":"poor","riskLeve…
GET /api/financial/transactions 200 in 2ms
12:33:19 AM [express] GET /api/financial/transactions 200 in 3ms :: []
GET /api/invoice-batches 200 in 1ms
12:33:19 AM [express] GET /api/invoice-batches 200 in 3ms :: []
Memory usage: { rss: 266.53, heapTotal: 114.6, heapUsed: 111.73, external: 10.93 }
GET /api/admin/data-counts 200 in 3ms
12:33:37 AM [express] GET /api/admin/data-counts 200 in 5ms :: {"representatives":1,"invoices":1,"pay…
GET /api/admin/data-counts 200 in 3ms
12:33:52 AM [express] GET /api/admin/data-counts 200 in 6ms :: {"representatives":1,"invoices":1,"pay…
Memory usage: { rss: 266.65, heapTotal: 114.85, heapUsed: 111.77, external: 10.96 }
Memory usage: { rss: 266.78, heapTotal: 114.85, heapUsed: 111.31, external: 10.94 }
Memory usage: { rss: 266.78, heapTotal: 114.85, heapUsed: 111.52, external: 11 }
Memory usage: { rss: 266.78, heapTotal: 114.85, heapUsed: 111.73, external: 11.06 }
Memory usage: { rss: 268.03, heapTotal: 115.1, heapUsed: 111.21, external: 10.91 }
Memory usage: { rss: 268.03, heapTotal: 115.1, heapUsed: 111.42, external: 10.97 }
Memory usage: { rss: 268.03, heapTotal: 115.1, heapUsed: 111.63, external: 11.03 }
Memory usage: { rss: 268.03, heapTotal: 115.1, heapUsed: 111.84, external: 11.09 }
Memory usage: { rss: 268.03, heapTotal: 116.1, heapUsed: 111.27, external: 10.93 }
Memory usage: { rss: 268.03, heapTotal: 116.1, heapUsed: 111.48, external: 10.99 }
Memory usage: { rss: 268.03, heapTotal: 116.1, heapUsed: 111.69, external: 11.05 }
POST /api/init 200 in 9ms
12:45:28 AM [express] POST /api/init 200 in 11ms :: {"success":true}
💰 Financial update for representative 1: {
  unpaidAmount: 100000,
  totalPayments: 70000,
  actualDebt: 30000,
  totalSales: '100000.00',
  credit: 0
}
🔄 SHERLOCK v1.0: Auto-allocating payment 2 to representative 1
📋 Found 1 unpaid invoices, oldest: INV-071903449 (1403/05/15)
💰 Financial update for representative 1: {
  unpaidAmount: 100000,
  totalPayments: 70000,
  actualDebt: 30000,
  totalSales: '100000.00',
  credit: 0
}
POST /api/payments 200 in 13ms
12:45:28 AM [express] POST /api/payments 200 in 14ms :: {"id":2,"representativeId":1,"invoiceId":1,"a…
💰 Financial update for representative 1: {
  unpaidAmount: 100000,
  totalPayments: 160000,
  actualDebt: 0,
  totalSales: '100000.00',
  credit: 60000
}
🔄 SHERLOCK v1.0: Auto-allocating payment 3 to representative 1
📋 Found 1 unpaid invoices, oldest: INV-071903449 (1403/05/15)
💰 Financial update for representative 1: {
  unpaidAmount: 100000,
  totalPayments: 160000,
  actualDebt: 0,
  totalSales: '100000.00',
  credit: 60000
}
POST /api/payments 200 in 15ms
12:45:28 AM [express] POST /api/payments 200 in 15ms :: {"id":3,"representativeId":1,"invoiceId":1,"a…
POST /api/constraints/validate 200 in 3ms
12:45:28 AM [express] POST /api/constraints/validate 200 in 3ms :: {"isValid":true,"violations":[]}
GET /api/constraints/violations 200 in 2ms
12:45:28 AM [express] GET /api/constraints/violations 200 in 3ms :: []
POST /api/financial/reconcile 200 in 3ms
12:45:28 AM [express] POST /api/financial/reconcile 200 in 4ms :: {"success":true,"message":"هماهنگی …
GET /api/payments/statistics 200 in 2ms
12:45:28 AM [express] GET /api/payments/statistics 200 in 7ms :: {"totalPayments":"3","totalAmount":"…
GET /api/invoices/unpaid/1 200 in 3ms
12:45:28 AM [express] GET /api/invoices/unpaid/1 200 in 4ms :: []
Memory usage: { rss: 268.4, heapTotal: 115.1, heapUsed: 112.16, external: 10.93 }
GET /health 200 in 0ms
POST /api/auth/login 200 in 86ms
12:45:50 AM [express] POST /api/auth/login 200 in 88ms :: {"success":true,"message":"ورود موفقیت‌آمیز…
POST /api/init 200 in 5ms
12:45:50 AM [express] POST /api/init 200 in 7ms :: {"success":true}
💰 Financial update for representative 1: {
  unpaidAmount: 100000,
  totalPayments: 180000,
  actualDebt: 0,
  totalSales: '100000.00',
  credit: 80000
}
🔄 SHERLOCK v1.0: Auto-allocating payment 4 to representative 1
📋 Found 1 unpaid invoices, oldest: INV-071903449 (1403/05/15)
💰 Financial update for representative 1: {
  unpaidAmount: 100000,
  totalPayments: 180000,
  actualDebt: 0,
  totalSales: '100000.00',
  credit: 80000
}
POST /api/payments 200 in 15ms
12:46:03 AM [express] POST /api/payments 200 in 16ms :: {"id":4,"representativeId":1,"invoiceId":1,"a…
💰 Financial update for representative 1: {
  unpaidAmount: 100000,
  totalPayments: 270000,
  actualDebt: 0,
  totalSales: '100000.00',
  credit: 170000
}
🔄 SHERLOCK v1.0: Auto-allocating payment 5 to representative 1
📋 Found 1 unpaid invoices, oldest: INV-071903449 (1403/05/15)
💰 Financial update for representative 1: {
  unpaidAmount: 100000,
  totalPayments: 270000,
  actualDebt: 0,
  totalSales: '100000.00',
  credit: 170000
}
POST /api/payments 200 in 12ms
12:46:03 AM [express] POST /api/payments 200 in 13ms :: {"id":5,"representativeId":1,"invoiceId":1,"a…
GET /api/payments/statistics 200 in 2ms
12:46:22 AM [express] GET /api/payments/statistics 200 in 4ms :: {"totalPayments":"5","totalAmount":"…
POST /api/constraints/validate 200 in 3ms
12:46:22 AM [express] POST /api/constraints/validate 200 in 5ms :: {"isValid":true,"violations":[]}
GET /api/constraints/violations 200 in 2ms
12:46:22 AM [express] GET /api/constraints/violations 200 in 4ms :: []
POST /api/financial/reconcile 200 in 2ms
12:46:22 AM [express] POST /api/financial/reconcile 200 in 4ms :: {"success":true,"message":"هماهنگی …
GET /api/invoices/unpaid/1 200 in 5ms
12:46:23 AM [express] GET /api/invoices/unpaid/1 200 in 7ms :: []
GET /api/invoices/1 200 in 2ms
12:46:31 AM [express] GET /api/invoices/1 200 in 5ms :: {"id":1,"invoiceNumber":"INV-071903449","repr…
GET /api/payments/representative/1 200 in 2ms
12:46:31 AM [express] GET /api/payments/representative/1 200 in 3ms :: [{"id":5,"representativeId":1,…
Memory usage: { rss: 268.78, heapTotal: 115.35, heapUsed: 112.14, external: 10.91 }
🔧 SHERLOCK v11.5: Starting batch invoice status recalculation...
📊 Processing ALL 1 invoices
✅ Batch recalculation complete: 1 invoices updated out of 1 processed
POST /api/invoices/recalculate-statuses 200 in 10ms
12:46:50 AM [express] POST /api/invoices/recalculate-statuses 200 in 12ms :: {"success":true,"message…
GET /api/invoices/1 200 in 4ms
12:46:50 AM [express] GET /api/invoices/1 200 in 5ms :: {"id":1,"invoiceNumber":"INV-071903449","repr…
GET /api/invoices/unpaid/1 200 in 2ms
12:46:50 AM [express] GET /api/invoices/unpaid/1 200 in 4ms :: []
GET /api/payments/allocation-summary/1 200 in 2ms
12:46:50 AM [express] GET /api/payments/allocation-summary/1 200 in 4ms :: {"totalPayments":5,"alloca…
📊 SHERLOCK v12.1: Calculating invoice statistics
📊 آمار فاکتورها: {
  totalInvoices: 1,
  unpaidCount: 0,
  paidCount: 1,
  partialCount: 0,
  overdueCount: 0,
  totalAmount: 100000,
  unpaidAmount: 0,
  paidAmount: 100000,
  sentToTelegramCount: 0,
  unsentToTelegramCount: 1
}
GET /api/invoices/statistics 200 in 3ms
12:46:50 AM [express] GET /api/invoices/statistics 200 in 4ms :: {"totalInvoices":1,"unpaidCount":0,"…
Memory usage: { rss: 268.9, heapTotal: 116.85, heapUsed: 112.52, external: 10.95 }
POST /api/auth/login 200 in 89ms
12:47:52 AM [express] POST /api/auth/login 200 in 91ms :: {"success":true,"message":"ورود موفقیت‌آمیز…
POST /api/init 200 in 5ms
12:47:52 AM [express] POST /api/init 200 in 7ms :: {"success":true}
💰 Financial update for representative 1: {
  unpaidAmount: 0,
  totalPayments: 290000,
  actualDebt: 0,
  totalSales: '100000.00',
  credit: 290000
}
POST /api/payments 200 in 8ms
12:47:52 AM [express] POST /api/payments 200 in 10ms :: {"id":6,"representativeId":1,"invoiceId":1,"a…
💰 Financial update for representative 1: {
  unpaidAmount: 0,
  totalPayments: 380000,
  actualDebt: 0,
  totalSales: '100000.00',
  credit: 380000
}
POST /api/payments 200 in 9ms
12:47:52 AM [express] POST /api/payments 200 in 10ms :: {"id":7,"representativeId":1,"invoiceId":1,"a…
POST /api/constraints/validate 200 in 3ms
12:47:52 AM [express] POST /api/constraints/validate 200 in 5ms :: {"isValid":true,"violations":[]}
POST /api/financial/reconcile 200 in 7ms
12:47:52 AM [express] POST /api/financial/reconcile 200 in 9ms :: {"success":true,"message":"هماهنگی …
GET /api/payments/statistics 200 in 2ms
12:47:52 AM [express] GET /api/payments/statistics 200 in 3ms :: {"totalPayments":"7","totalAmount":"…
GET /api/invoices/1 200 in 2ms
12:47:52 AM [express] GET /api/invoices/1 200 in 4ms :: {"id":1,"invoiceNumber":"INV-071903449","repr…
📊 SHERLOCK v12.1: Calculating invoice statistics
📊 آمار فاکتورها: {
  totalInvoices: 1,
  unpaidCount: 0,
  paidCount: 1,
  partialCount: 0,
  overdueCount: 0,
  totalAmount: 100000,
  unpaidAmount: 0,
  paidAmount: 100000,
  sentToTelegramCount: 0,
  unsentToTelegramCount: 1
}
GET /api/invoices/statistics 200 in 3ms
12:47:52 AM [express] GET /api/invoices/statistics 200 in 4ms :: {"totalInvoices":1,"unpaidCount":0,"…
Memory usage: { rss: 269.4, heapTotal: 116.1, heapUsed: 112.51, external: 10.92 }
Memory usage: { rss: 269.4, heapTotal: 116.1, heapUsed: 112.71, external: 10.98 }
Memory usage: { rss: 269.4, heapTotal: 116.1, heapUsed: 112.92, external: 11.04 }
Memory usage: { rss: 269.4, heapTotal: 116.1, heapUsed: 113.13, external: 11.1 }
Memory usage: { rss: 269.4, heapTotal: 116.1, heapUsed: 112.64, external: 10.95 }
Memory usage: { rss: 269.4, heapTotal: 116.1, heapUsed: 112.85, external: 11.02 }
POST /api/auth/login 200 in 94ms
12:54:27 AM [express] POST /api/auth/login 200 in 96ms :: {"success":true,"message":"ورود موفقیت‌آمیز…
🔧 فاز ۲: ایجاد فاکتور دستی
💰 Financial update for representative 1: {
  unpaidAmount: 50000,
  totalPayments: 380000,
  actualDebt: 0,
  totalSales: '150000.00',
  credit: 330000
}
💰 Financial update for representative 1: {
  unpaidAmount: 50000,
  totalPayments: 380000,
  actualDebt: 0,
  totalSales: '150000.00',
  credit: 330000
}
POST /api/invoices/create-manual 200 in 18ms
12:54:27 AM [express] POST /api/invoices/create-manual 200 in 19ms :: {"success":true,"invoice":{"id"…
💰 Financial update for representative 1: {
  unpaidAmount: 50000,
  totalPayments: 460000,
  actualDebt: 0,
  totalSales: '150000.00',
  credit: 410000
}
🔄 SHERLOCK v1.0: Auto-allocating payment 8 to representative 1
📋 Found 1 unpaid invoices, oldest: INV-667232612 (1403/05/17)
💰 Financial update for representative 1: {
  unpaidAmount: 0,
  totalPayments: 460000,
  actualDebt: 0,
  totalSales: '150000.00',
  credit: 460000
}
POST /api/payments 200 in 13ms
12:54:27 AM [express] POST /api/payments 200 in 15ms :: {"id":8,"representativeId":1,"invoiceId":null…
POST /api/payments/8/allocate 200 in 2ms
12:54:27 AM [express] POST /api/payments/8/allocate 200 in 6ms :: {"id":8,"representativeId":1,"invoi…
GET /api/invoices/2 200 in 2ms
12:54:27 AM [express] GET /api/invoices/2 200 in 3ms :: {"id":2,"invoiceNumber":"INV-667232612","repr…
GET /api/payments/representative/1 200 in 1ms
12:54:27 AM [express] GET /api/payments/representative/1 200 in 3ms :: [{"id":8,"representativeId":1,…
Memory usage: { rss: 269.53, heapTotal: 116.35, heapUsed: 113.19, external: 10.94 }
Memory usage: { rss: 269.65, heapTotal: 116.35, heapUsed: 112.73, external: 10.92 }
12:55:52 AM [express] Received SIGTERM signal, starting graceful shutdown...
12:55:53 AM [express] HTTP server closed
Database connections closed gracefully
12:55:53 AM [express] Graceful shutdown complete
